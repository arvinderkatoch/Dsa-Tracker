<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LC / SRS / TRACKER</title>
    <style>
        :root {
            --bg: #fafafa;
            --text: #1a1a1a;
            --accent: #000;
            --border: #e1e1e1;
            --star: #ffd700;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, monospace;
            display: flex;
            justify-content: center;
            padding: 40px 20px;
            margin: 0;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 650px;
        }

        header {
            margin-bottom: 50px;
            border-bottom: 2px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding-bottom: 10px;
        }

        h1 { font-size: 1.2rem; font-weight: 800; letter-spacing: -0.05em; margin: 0; }
        .date-display { font-size: 0.8rem; font-family: monospace; opacity: 0.5; }

        .input-box {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
        }

        input, select {
            border: 1px solid var(--border);
            padding: 10px;
            background: white;
            font-size: 0.9rem;
            outline: none;
            transition: border 0.2s;
        }

        input:focus { border-color: var(--accent); }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        button:hover { opacity: 0.8; }

        .section-label {
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 15px;
            display: block;
            opacity: 0.4;
        }

        .list { margin-bottom: 40px; }

        .item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            gap: 15px;
        }

        .item-info { flex-grow: 1; }
        .item-name { font-size: 0.95rem; font-weight: 500; }
        .item-meta { font-size: 0.75rem; opacity: 0.5; font-family: monospace; }

        .star { cursor: pointer; font-size: 1.1rem; filter: grayscale(1); }
        .star.active { filter: grayscale(0); }

        .btn-done { background: #f0f0f0; color: #000; border: 1px solid #ddd; }
        .btn-undo { background: #000; color: #fff; }
        .btn-del { background: transparent; color: #ff4444; font-size: 1.2rem; padding: 0 10px; }

        .empty { font-size: 0.8rem; opacity: 0.3; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>LC_TRACKER.SYS</h1>
        <div class="date-display" id="currentDate"></div>
    </header>

    <div class="input-box">
        <input type="text" id="qName" placeholder="Question name..." style="flex-grow: 1;">
        <select id="qDiff">
            <option value="Easy">EASY</option>
            <option value="Medium">MEDIUM</option>
            <option value="Hard">HARD</option>
        </select>
        <button onclick="addQuestion()">ADD</button>
    </div>

    <span class="section-label">Due for recall today</span>
    <div id="dueList" class="list"></div>

    <span class="section-label">System Archive (All)</span>
    <div id="allList" class="list"></div>
</div>

<script>
    let questions = JSON.parse(localStorage.getItem('min_lc_data')) || [];
    let lastSolvedState = null; // For Undo

    function updateDate() {
        const d = new Date();
        document.getElementById('currentDate').innerText = d.toISOString().split('T')[0];
    }

    function save() {
        localStorage.setItem('min_lc_data', JSON.stringify(questions));
        render();
    }

    function addQuestion() {
        const name = document.getElementById('qName').value;
        const diff = document.getElementById('qDiff').value;
        if(!name) return;

        questions.push({
            id: Date.now(),
            name,
            diff,
            starred: false,
            nextReview: new Date().toISOString(),
            prevReview: null // Store for Undo
        });
        document.getElementById('qName').value = '';
        save();
    }

    function toggleStar(id) {
        const q = questions.find(q => q.id === id);
        q.starred = !q.starred;
        save();
    }

    function deleteQuestion(id) {
        if(confirm('Delete record?')) {
            questions = questions.filter(q => q.id !== id);
            save();
        }
    }

    function markDone(id) {
        const q = questions.find(q => q.id === id);
        lastSolvedState = { id, prevDate: q.nextReview }; // Store state for undo
        
        const intervals = { 'Easy': 7, 'Medium': 3, 'Hard': 1 };
        const next = new Date();
        next.setDate(next.getDate() + intervals[q.diff]);
        
        q.prevReview = q.nextReview;
        q.nextReview = next.toISOString();
        save();
    }

    function undo(id) {
        const q = questions.find(q => q.id === id);
        if(q.prevReview) {
            q.nextReview = q.prevReview;
            q.prevReview = null;
            lastSolvedState = null;
            save();
        }
    }

    function render() {
        const dueList = document.getElementById('dueList');
        const allList = document.getElementById('allList');
        dueList.innerHTML = '';
        allList.innerHTML = '';

        const today = new Date().toISOString().split('T')[0];

        if (questions.length === 0) {
            allList.innerHTML = '<div class="empty">No data found in system.</div>';
        }

        questions.forEach(q => {
            const isDue = q.nextReview.split('T')[0] <= today || q.starred;
            const isJustSolved = lastSolvedState && lastSolvedState.id === q.id;

            const itemHtml = `
                <div class="item">
                    <div class="star ${q.starred ? 'active' : ''}" onclick="toggleStar(${q.id})">★</div>
                    <div class="item-info">
                        <div class="item-name">${q.name}</div>
                        <div class="item-meta">${q.diff.toUpperCase()} / NEXT: ${q.nextReview.split('T')[0]}</div>
                    </div>
                    ${isJustSolved ? 
                        `<button class="btn-undo" onclick="undo(${q.id})">UNDO</button>` : 
                        `<button class="btn-done" onclick="markDone(${q.id})">DONE</button>`
                    }
                    <button class="btn-del" onclick="deleteQuestion(${q.id})">×</button>
                </div>
            `;

            if(isDue) dueList.innerHTML += itemHtml;
            allList.innerHTML += itemHtml;
        });

        if (dueList.innerHTML === '') {
            dueList.innerHTML = '<div class="empty">System clear. No reviews due.</div>';
        }
    }

    updateDate();
    render();
</script>

</body>
</html>
